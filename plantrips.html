<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Plan Your Trip | HiddenTrails.AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- NAVBAR -->
<nav class="bg-white shadow px-6 py-4 flex justify-between items-center sticky top-0 z-50">
  <h1 class="text-2xl font-bold text-green-600">HiddenTrails.AI</h1>
  <div class="space-x-6">
    <a href="index.html" class="text-gray-600 hover:text-green-600">Home</a>
    <a href="dashboard.html" class="text-gray-600 hover:text-green-600">Dashboard</a>
    <a href="saved.html" class="text-gray-600 hover:text-green-600">Saved</a>
    <a href="auth.html" class="bg-green-600 text-white px-4 py-2 rounded-lg">Logout</a>
  </div>
</nav>

<div class="flex">

  <!-- SIDEBAR -->
   <aside class="w-64 bg-white shadow p-5 space-y-4 
              fixed top-16 left-0 h-[calc(100vh-64px)] 
              overflow-y-auto">

  <a href="dashboard.html" class="block text-gray-700 hover:text-green-600">
    üè† Dashboard
  </a>

  <a href="plantrips.html" class="block font-semibold text-green-600">
    üß≠ Plan Trip
  </a>

  <a href="saved.html" class="block text-gray-700 hover:text-green-600">
    üíæ Saved Trips
  </a>

  <a href="rewards.html" class="block text-gray-700 hover:text-green-600">
    üéÅ Rewards
  </a>

</aside>
  

  <!-- MAIN CONTENT -->
 
     <main class="flex-1 p-8 ml-64">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow">

      <h2 class="text-3xl font-bold mb-6 text-center">Plan Your Trip ‚úàÔ∏è</h2>

      <form id="tripForm" class="space-y-5">

        <div>
          <label class="block font-semibold">Destination</label>
          <input id="destination" type="text" placeholder="Goa, Delhi, Kolkata"
            class="w-full border rounded-lg px-4 py-2">
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold">Arrival Date</label>
            <input id="arrivalDate" type="date"
              class="w-full border rounded-lg px-4 py-2">
          </div>
          <div>
            <label class="block font-semibold">Return Date</label>
            <input id="returnDate" type="date"
              class="w-full border rounded-lg px-4 py-2">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold">Number of Days</label>
            <input id="days" type="number" placeholder="3"
              class="w-full border rounded-lg px-4 py-2">
          </div>
          <div>
            <label class="block font-semibold">Budget (‚Çπ)</label>
            <input id="budget" type="number" placeholder="30000"
              class="w-full border rounded-lg px-4 py-2">
          </div>
        </div>

        <div>
          <label class="block font-semibold">Travel Preference</label>
          <select id="preference"
            class="w-full border rounded-lg px-4 py-2">
            <option>Adventure</option>
            <option>Relaxation</option>
            <option>Culture</option>
            <option>Nature</option>
            <option>Luxury</option>
          </select>
        </div>

        <button type="submit" id="generateBtn" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700">
  Generate Itinerary
</button>

       

      </form>

    </div>
  </main>

</div>

<!-- SCRIPT -->
 <script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCtSKfk3j-RaExSaumaeGoQlJQckBDZ32c",
  authDomain: "hiddentrails-ai.firebaseapp.com",
  projectId: "hiddentrails-ai",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("tripForm");
const btn = document.getElementById("generateBtn");

form.addEventListener("submit", async function (e) {
  e.preventDefault();

  const destination = document.getElementById("destination").value.trim();
  const budget = parseInt(document.getElementById("budget").value);
  const preference = document.getElementById("preference").value;

  const arrivalDate = document.getElementById("arrivalDate").value;
  const returnDate = document.getElementById("returnDate").value;

  const diffTime = new Date(returnDate) - new Date(arrivalDate);
  const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;

  if (days <= 0) {
    alert("Return date must be after arrival date.");
    return;
  }

  if (!destination || !budget || !preference || !arrivalDate || !returnDate) {
    alert("Please fill all required fields");
    return;
  }

  btn.disabled = true;
  btn.innerText = "Generating...";

  try {
    const response = await fetch("http://127.0.0.1:5000/generate-itinerary", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        destination,
        days,
        preference,
        budget
      })
    });

    if (!response.ok) {
      const errData = await response.json();
      alert("Backend error: " + errData.error);
      return;
    }

   

    const data = await response.json();

if (!data || !Array.isArray(data.days)) {
  alert("AI failed to generate itinerary");
  return;
}

/* üî• STEP 1: FETCH DESTINATION IMAGE */
const imageRes = await fetch(
  `http://127.0.0.1:5000/get-destination-image?query=${destination}`
);

const imageData = await imageRes.json();

/* attach image */
const heroImage = imageData.image;

const docRef = await addDoc(collection(db, "trips"), {
  destination,
  daysCount: days,
  budget,
  preference,
  arrivalDate,
  returnDate,
  total_estimated_cost: data.total_estimated_cost,
  days: data.days,

  /* ‚úÖ SAVE IMAGE HERE */
  hero_image: heroImage,

  createdAt: new Date()
});

    

    window.location.href = `itinerary.html?id=${docRef.id}`;

  } catch (err) {
    console.error(err);
    alert("Something went wrong.");
  } finally {
    btn.disabled = false;
    btn.innerText = "Generate Itinerary";
  }
});

</script>


</body>
</html>
